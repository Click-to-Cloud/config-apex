<!DOCTYPE html><html><head><meta charset="UTF-8"><meta content="minimum-scale=1.0, width=device-width" name="viewport"><meta name="description" content="Config Service"><title>Config - Config.apex</title><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Roboto+Mono"><link rel="stylesheet" href="/config-apex/vendor/icon-12/icon-12.css"><link rel="stylesheet" href="/config-apex/vendor/icon-16/icon-16.css"><link rel="stylesheet" href="/config-apex/vendor/galano/galano.css"><link rel="stylesheet" href="/config-apex/vendor/senna/senna.css"><link rel="stylesheet" href="/config-apex/vendor/codemirror/lib/codemirror.css"><link rel="stylesheet" href="/config-apex/vendor/codemirror/theme/dracula.css"><script src="/config-apex/js/bundles/shared.electric.js"></script><script src="/config-apex/vendor/senna/senna.js"></script><script src="/config-apex/vendor/codemirror/lib/codemirror.js"></script><script src="/config-apex/vendor/codemirror/mode/css/css.js"></script><script src="/config-apex/vendor/codemirror/mode/javascript/javascript.js"></script><script src="/config-apex/vendor/codemirror/mode/xml/xml.js"></script><link rel="stylesheet" href="/config-apex/styles/main.css"></head><body data-senna=""><div data-senna-surface="" id="wrapper"><div class="senna-loading-bar"></div><div id="pageComponent"><div class="main"><main class="guide"><div class="docs"><nav class="topbar topbar-light topbar-docs"><div class="topbar-logo"><a class="topbar-logo-link" href="/config-apex"><span class="topbar-logo-icon icon-16-hammer"></span><h3 class="topbar-logo-text">Config.apex</h3></a></div><nav class="topbar-menu"><button class="topbar-toggle">Menu</button><ul class="topbar-list"><li class="topbar-item"><a class="topbar-link topbar-link-selected" href="/config-apex/docs/" target="undefined"><span>Docs</span></a></li><li class="topbar-item"><a class="topbar-link " href="/config-apex/tutorials/getting_started/step_1.html" target="undefined"><span>Tutorials</span></a></li></ul></nav></nav><nav class="sidebar"><a class="sidebar-header toggler-header-collapsed"><span class="sidebar-icon icon-16-menu"></span><span>Docs Menu</span><span class="sidebar-icon-right"><span class="icon-12-arrow-down-short"></span><span class="icon-12-arrow-up-short"></span></span></a><div class="sidebar-toggler-content toggler-collapsed"><div class="sidebar-search"><div class="page-autocomplete"><div class="form-group"><div class="input-inner-addon input-inner-addon-right"><input autocomplete="off" class="form-control" name="q" placeholder="Search Docs" ref="input" required="" type="text"><span class="input-inner-icon-helper icon-16-magnifier"></span></div></div></div></div><nav class=""><ul class="sidebar-list sidebar-list-1"><li class="sidebar-item active"><a class="sidebar-link sidebar-link-selected" href="/config-apex/docs/Config/"><span class="sidebar-icon icon-16-flash"></span><span>Config</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/config-apex/docs/SObjectHandler/"><span class="sidebar-icon icon-16-code-file"></span><span>SObjectHandler</span></a></li><li class="sidebar-item"><a class="sidebar-link " href="/config-apex/docs/CacheStore/"><span class="sidebar-icon icon-16-cloud"></span><span>CacheStore</span></a></li></ul></nav></div></nav><div class="sidebar-offset"><header class="guide-header"><div class="container-hybrid"><h1 class="title">Config Guide</h1></div></header><div class="container-hybrid"><div class="docs-guide row"><div class="docs-content col-xs-16 col-md-9"><div class="guide-content"><h6>Config Service</h6><article id="1"><h2>Background</h2><p>In a large system, we may encounter configurations from different sources. For example, we can store configurations in custom settings, or some custom SObjects. Even we can read configurations from external web services. So configurations are grouped by where they come from, and when we want to use the configs, we need to know their sources. However, what we ideally want is that our configurations are grouped by features and functions, and we don't want to be disturbed by where the configs come from and how we should access the configs. Under this background, we have the idea of building a config system, which provides a unified API that gives a consistent access to our configurations.</p></article><article id="2"><h2>Config Service</h2><p>With the purpose above, we built the Config Service, which behaves pretty much like the http service.</p><p>Here are the factors involved in Config Service:</p><ul><li><p>Config URL A config service provider is bound to a specific config url. A config URL may be an exact String, or a pattern that matches a range of Strings, with variables starting with '$ and ending with '.</p></li><li><p>Config Request A request for retrieving or updating the value of the configuration url. Like http requests, we can request a config url like this:</p></li></ul><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">/System/version?type=String</code></pre></div><p>Additional parameters may be specified. Also when it comes to the requests for updating, we can send the data of <code>Map<string, object=""></string,></code>.</p><p>Config requests are divided into two types: <code>read</code>(<code>get</code>) and <code>write</code>(<code>put</code>).</p><ul><li><p>Config Response For <code>read</code> config request, we respond with the value of the config. For <code>write</code> config request, the response is not used.</p></li><li><p>Config Handler A config handler is a Func used to process the logic for config requests. Usually we need to specify a config handler for each type of the config request.</p></li></ul></article><article id="3"><h2>Config Service Setup</h2><p>Config service uses <code>CacheStore</code> to improve performance, so we need an instance of CacheStore to build the config service.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">CacheStore store = new CacheStore('PARTITION');
Config configService = new Config(store);</code></pre></div><p>It's recommended that for one application, we use one global config service like this:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public class MyConfig {
    private static Config configService;

    public static Config getConfig() {
        if(configService == null) {
            CacheStore store = new CacheStore('PARTITION_NAME');
            configService = new Config(store);

            // set up the config service
        }

        return configService;
    }
}</code></pre></div><p>During the setup, we need register config handlers.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">configService.onRead('/System/version', new SystemVersionFunc());
configService.onWrite('/System/version', new SystemVersionWriteFunc());</code></pre></div></article><article id="4"><h2>Config Handlers</h2><p>A config handler is actuall a Func.</p><p>Here is how we implement a <code>onRead</code> handler.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public class OnReadFunc extends Func {
    public override Object exec(Object arg) {
        Map<string, string=""> params = (Map<string, string="">)arg;
        // Custom logic
        return 'config value';
    }
}</string,></string,></code></pre></div><p>The <code>params</code> are collected from the config request. For example, for a config request like this,</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">Config request
/System/version/1?type=String</code></pre></div><p><code>params</code> will be collected as:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">{ 'number' =&gt; '1', 'type' =&gt; 'String' }</code></pre></div><p>Here is how we implement a <code>onWrite</code> handler.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">public class OnWriteFunc extends Func {
    public override Object exec(Object arg1, Object arg2) {
        Map<string, string=""> params = (Map<string, string="">)arg1;
        Map<string, object=""> data = (Map<string, object="">)arg2;
        // Custom logic
        return null;
    }
}</string,></string,></string,></string,></code></pre></div></article><article id="5"><h2>Read Configuration</h2><p>After the config service is set up, we can use it globally to read configurations.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">String version = (String)configService.read('/System/version');
// equivalent to
String version = (String)configService.get('/System/version');</code></pre></div><p>By default, we can even specify what kind of data type we want to get.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">String version = (String)configService.read('/System/version?type=String');</code></pre></div><p>Config.apex will convert the result configuration value according to the type you specified.</p></article><article id="6"><h2>Write Configuration</h2><p>We can write configurations too, using the config service.</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">configService.write('/System/version', new Map<string, object="">{
    'value': '1.0.0'
});
// equivalent to
configService.put('/System/version', new Map<string, object="">{
    'value': '1.0.0'
});</string,></string,></code></pre></div><p>We can pass in both params from the request config url and the data of <code>Map<string, object=""></string,></code>.</p></article><article id="7"><h2>Constructors</h2><table><thead><tr><th>Constructor</th><th>Description</th></tr></thead><tbody><tr><td>Config(CacheStore)</td><td>Create a config from the CacheStore</td></tr></tbody></table></article><article id="8"><h2>Common Methods</h2><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>getConfigPaths()</td><td>Get all config paths</td></tr><tr><td>get(String)</td><td>Get the config</td></tr><tr><td>read(String)</td><td>Read the config</td></tr><tr><td>put(String, Map<string, object="">)</string,></td><td>Write the config</td></tr><tr><td>write(String, Map<string, object="">)</string,></td><td>Write the config</td></tr></tbody></table></article><article id="9"><h2>Setup Methods</h2><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>onReadWrite(String, Boolean, String, Func, Func)</td><td>Register read/write handlers</td></tr><tr><td>onReadWrite(String, Boolean, Func, Func)</td><td>Register read/write handlers</td></tr><tr><td>onReadWrite(String, Func, Func)</td><td>Register read/write handlers</td></tr><tr><td>onRead(String, Boolean, String, Func)</td><td>Register read handler</td></tr><tr><td>onRead(String, Boolean, Func)</td><td>Register read handler</td></tr><tr><td>onRead(String, Func)</td><td>Register read handler</td></tr><tr><td>onWrite(String, Boolean, String, Func)</td><td>Register write handler</td></tr><tr><td>onWrite(String, Boolean, Func)</td><td>Register write handler</td></tr><tr><td>onWrite(String, Func)</td><td>Register write handler</td></tr></tbody></table></article><input type="hidden" value="Config"><input type="hidden" value="Config.apex"></div><div class="contribute"><div class="contribute-img"><span class="icon-16-github"></span></div><div class="contribute-text"><p>Contribute on Github! <a href="https://github.com/Click-to-Cloud/Config.apex/tree/master/src/pages/docs/Config/index.md" class="contribute-link" target="_blank">Edit this section</a>.</p></div></div></div><nav class="col-xs-16 col-md-offset-2 col-md-5"><div class="docs-nav-container"><div class="affix-top docs-nav"><div ref="readingContainer"></div></div></div></nav></div></div></div></div></main></div></div><script src="/config-apex/js/bundles/QtnMr.js"></script><script>var data = '{"pageLocation":"index.children.docs.children.Config","site":{"title":"Config.apex","githubRepo":"Click-to-Cloud/Config.apex","googleAnalytics":"","index":{"title":"Home","description":"Config.apex is a library to manage your configurations and cache in an elegant way.","srcFilePath":"src/pages/index.soy","id":"pages","location":"/./","url":"/config-apex/./","children":{"docs":{"title":"Docs","description":"Everything you need to know to get started.","srcFilePath":"src/pages/docs/index.soy","id":"docs","location":"/docs/","url":"/config-apex/docs/","children":{"search":{"title":"Search","description":"Find what you\'re looking for in the documentation.","hidden":true,"srcFilePath":"src/pages/docs/search.soy","id":"search","location":"/docs/search.html","url":"/config-apex/docs/search.html"},"Config":{"title":"Config","description":"Config Service","layout":"guide","icon":"flash","weight":1,"srcFilePath":"src/pages/docs/Config/index.md","id":"Config","location":"/docs/Config/","url":"/config-apex/docs/Config/","active":true},"SObjectHandler":{"title":"SObjectHandler","description":"SObjectHandler","layout":"guide","icon":"code-file","weight":2,"srcFilePath":"src/pages/docs/SObjectHandler/index.md","id":"SObjectHandler","location":"/docs/SObjectHandler/","url":"/config-apex/docs/SObjectHandler/"},"CacheStore":{"title":"CacheStore","description":"CacheStore","layout":"guide","icon":"cloud","weight":4,"srcFilePath":"src/pages/docs/CacheStore/index.md","id":"CacheStore","location":"/docs/CacheStore/","url":"/config-apex/docs/CacheStore/"}},"childIds":["Config","SObjectHandler","CacheStore","search"],"active":true},"tutorials":{"title":"Tutorials","description":"The tutorials","url":"/config-apex/tutorials/getting_started/step_1.html","layout":false,"srcFilePath":"src/pages/tutorials/index.soy","id":"tutorials","location":"/tutorials/","customURL":true,"children":{"getting_started":{"title":"Getting Started","description":"The Getting Started Tutorial","tutorialTitle":"Getting started with Config.apex","url":"/config-apex/tutorials/getting_started/step_1.html","layout":false,"srcFilePath":"src/pages/tutorials/getting_started/index.soy","id":"getting_started","location":"/tutorials/getting_started/","customURL":true,"children":{"step_1":{"title":"Installation","description":"Include Apex files","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":1,"srcFilePath":"src/pages/tutorials/getting_started/step_1.md","id":"step_1","location":"/tutorials/getting_started/step_1.html","url":"/config-apex/tutorials/getting_started/step_1.html"},"step_2":{"title":"Preliminary Knowledge","description":"Preliminary Knowledge","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":2,"srcFilePath":"src/pages/tutorials/getting_started/step_2.md","id":"step_2","location":"/tutorials/getting_started/step_2.html","url":"/config-apex/tutorials/getting_started/step_2.html"},"step_3":{"title":"Cache Management","description":"Cache Management","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":3,"srcFilePath":"src/pages/tutorials/getting_started/step_3.md","id":"step_3","location":"/tutorials/getting_started/step_3.html","url":"/config-apex/tutorials/getting_started/step_3.html"},"step_4":{"title":"Config Service","description":"Config Service","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":4,"srcFilePath":"src/pages/tutorials/getting_started/step_4.md","id":"step_4","location":"/tutorials/getting_started/step_4.html","url":"/config-apex/tutorials/getting_started/step_4.html"},"step_5":{"title":"Config Handlers","description":"Config Handlers","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":5,"srcFilePath":"src/pages/tutorials/getting_started/step_5.md","id":"step_5","location":"/tutorials/getting_started/step_5.html","url":"/config-apex/tutorials/getting_started/step_5.html"},"step_6":{"title":"Read Configuration","description":"Read Configuration","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":6,"srcFilePath":"src/pages/tutorials/getting_started/step_6.md","id":"step_6","location":"/tutorials/getting_started/step_6.html","url":"/config-apex/tutorials/getting_started/step_6.html"},"step_7":{"title":"Write Configuration","description":"Write Configuration","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":7,"srcFilePath":"src/pages/tutorials/getting_started/step_7.md","id":"step_7","location":"/tutorials/getting_started/step_7.html","url":"/config-apex/tutorials/getting_started/step_7.html"},"step_8":{"title":"Integrations","description":"Integrations","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":8,"srcFilePath":"src/pages/tutorials/getting_started/step_8.md","id":"step_8","location":"/tutorials/getting_started/step_8.html","url":"/config-apex/tutorials/getting_started/step_8.html"}},"childIds":["step_1","step_2","step_3","step_4","step_5","step_6","step_7","step_8"]}},"childIds":["getting_started"]}},"childIds":["docs","tutorials"]},"basePath":"/config-apex","topbar":[{"href":"/config-apex/docs/","label":"Docs","selected":true},{"href":"/config-apex/tutorials/getting_started/step_1.html","label":"Tutorials"}]}}'; if (typeof electric !== 'undefined') {electric.init(data);}else {document.addEventListener('DOMContentLoaded', function() {electric.init(data);});}</script></div><script data-senna-track="permanent" src="/config-apex/js/electric/electric.js"></script></body></html>